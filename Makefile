# Makefile for CVE-2019-2215 for Pixel 2 and Pixel 2 XL
# Requires the $NDK environment variable to be set
# containing the base path to Android NDK r19 or higher.

CC				= $(NDK)/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang
CFLAGS			= -O3 -s -Wall -Wextra -pedantic -Wformat -Werror=format-security

OBJS			= cve-2019-2215.o


.PHONY:			all
all:			cve-2019-2215

debug:			CFLAGS := $(filter-out -O3 -s,$(CFLAGS)) -g
debug:			clean cve-2019-2215

cve-2019-2215:	$(OBJS)
				$(CC) -o $@ $^ $(CFLAGS)

clean:
				rm -f cve-2019-2215 $(OBJS)

%.o:			$(CC) -c -o $@ $< $(CFLAGS) -Wl,$(LDFLAGS)
