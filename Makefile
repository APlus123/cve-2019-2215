# Makefile for CVE-2019-2215 for Pixel 2 and Pixel 2 XL
# Requires the $NDK environment variable to be set
# containing the base path to Android NDK r19 or higher.

CC		= $(NDK)/toolchains/llvm/prebuilt/linux-x86_64/bin/aarch64-linux-android21-clang
CFLAGS	= -O3 -pie -Wall -Wextra -pedantic -Wformat -Werror=format-security

OBJS	= poc.o


.PHONY:	all
all:	poc

debug:	CFLAGS := $(filter-out -O3,$(CFLAGS)) -g
debug:	clean poc

poc:	$(OBJS)
		$(CC) -o $@ $^ $(CFLAGS)

clean:
		rm -f poc $(OBJS)

%.o:	$(CC) -c -o $@ $< $(CFLAGS)
